<template lang="pug">
nav
  v-app-bar(promiment, shrink-on-scroll, app)
    // Title
    v-toolbar-title.text-uppercase.grey--text
      #superellipse(@click='ellipseHovered')
        svg( style='width: 100px; height: 100px;' width='200' height='200' viewBox='-50 -50 100 100' fill='linear-gradient(to bottom right, orange, orangered)' xmlns='http://www.w3.org/2000/svg' )
          //- filter(id='cut')
            feImage(:xlink:href='require("../assets/avatar.png")'  result='img')
            feBlend(in='img' in2='SourceGraphic' mode='darken')
          //- image(href='../assets/avatar.png')
          //- path(:d='d' fill='white')
          
          //- g(filter='url(#cut)')
            path(:d='d' fill='white')
          mask#img-mask
            rect(x='-50' y='-50' height='100px' width='100px' fill='black')
            path(:d='d' fill='white')
          path(:d='d' fill='url(#Gradient1)')
          image(:href='require("../assets/avatar.png")' x='-50px' y='-50px' height='100px' width='100px' mask='url(#img-mask)')
          defs
            linearGradient#Gradient1(x1="0" x2="1" y1="0" y2="1")
              stop.stop1(offset="0%")
              stop.stop3(offset="100%")
      span {{ $t("title") }}
    v-spacer
    // Dark mode
    v-btn(text, icon, color='grey', @click='toggleMode')
      v-icon(small) brightness_2
    // Language picker
    v-menu(offset-y)
      template(v-slot:activator='{ on }')
        v-btn(text, icon, color='grey', v-on='on') {{ currentLocale.icon }}
      v-list
        v-list-item(
          v-for='locale in locales',
          @click='changeLanguage(locale.code)',
          :key='locale.code'
        )
          v-list-item-title {{ locale.icon }}
</template>

<script lang="ts">
import Vue from 'vue'
import Component from 'vue-class-component'
import { i18n } from '@/plugins/i18n'
import * as api from '@/utils/api'
import { namespace } from 'vuex-class'

const AppStore = namespace('AppStore')

@Component
export default class Navbar extends Vue {
  @AppStore.State dark!: boolean

  @AppStore.Mutation setDark!: (dark: boolean) => void
  @AppStore.Mutation setLanguage!: (language: string) => void

  get locales() {
    return [
      { icon: 'ðŸ‡ºðŸ‡¸', code: 'en' },
      { icon: 'ðŸ‡·ðŸ‡º', code: 'ru' },
    ]
  }
  get currentLocale() {
    for (const locale of this.locales) {
      if (locale.code === i18n.locale) {
        return locale
      }
    }
  }

  get windowHeight() {
    return window.innerHeight
  }

  toggleMode() {
    this.setDark(!this.dark)
    ;(this.$vuetify.theme as any).dark = this.dark
  }
  changeLanguage(locale: string) {
    i18n.locale = locale
    this.setLanguage(locale)
    document.title = i18n.t('strippedTitle') as string
  }

  d = ''

  maskPath(eccentricity: number) {
    const halfWidth = 100 / 2.0
    const halfHeight = 100 / 2.0

    const TWO_PI = Math.PI * 2.0
    const resolution = 100

    var d = 'M ' + halfWidth + ' ' + 0

    // wierd math https://observablehq.com/@tomwhite/superellipse-generator

    for (var theta = 0.0; theta < TWO_PI; theta += TWO_PI / resolution) {
      var sineTheta = Math.sin(theta)
      var cosineTheta = Math.cos(theta)
      var r = Math.pow(
        1 /
          (Math.pow(Math.abs(cosineTheta) / halfWidth, eccentricity) +
            Math.pow(Math.abs(sineTheta) / halfHeight, eccentricity)),
        1 / eccentricity
      )
      d += ' L ' + r * cosineTheta + ' ' + r * sineTheta
    }
    return d
  }

  mounted() {
    this.d = this.maskPath(3); 
  }

  ellipseHovered() {
    if (this.d === this.maskPath(3))
      this.d = this.maskPath(9);
    else this.d = this.maskPath(3);
  }
}
</script>

<style>
nav a:link {
  text-decoration: none;
}

nav a:visited {
  text-decoration: none;
}

nav a:hover {
  text-decoration: underline;
}

nav a:active {
  text-decoration: underline;
}

#superellipse {
  height: 100px;
  width: 100px;
  /* --mask: url("data:image/svg+xml,%3Csvg width='200' height='200' viewBox='-50 -50 100 100' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 50 0 L 49.999999999999986 0 L 49.999107689126554 3.145677223240798 L 49.989767842436464 6.315176300200244 L 49.95677212981057 9.529763953669523 L 49.87814575846598 12.806531166834697 L 49.72412933283185 16.156348998269472 L 49.455699619313194 19.58089667397289 L 49.02340517788066 23.06866342010638 L 48.36757380251155 26.590298713207872 L 47.42138052245481 30.094523195734013 L 46.11831883232672 33.506919951795894 L 44.404526850236635 36.73461933738229 L 42.253686029814624 39.678852283183275 L 39.678852283183296 42.25368602981461 L 36.73461933738231 44.40452685023662 L 33.506919951795915 46.118318832326715 L 30.09452319573403 47.42138052245481 L 26.590298713207883 48.36757380251155 L 23.068663420106382 49.02340517788066 L 19.580896673972887 49.455699619313194 L 16.15634899826946 49.72412933283184 L 12.806531166834679 49.878145758465976 L 9.529763953669505 49.95677212981057 L 6.315176300200222 49.989767842436464 L 3.145677223240772 49.999107689126554 L -3.0245073740886305e-14 49.999999999999986 L -3.1456772232408325 49.999107689126554 L -6.315176300200284 49.98976784243647 L -9.529763953669569 49.95677212981057 L -12.806531166834743 49.878145758465976 L -16.156348998269525 49.724129332831836 L -19.58089667397296 49.455699619313194 L -23.06866342010644 49.02340517788066 L -26.59029871320794 48.367573802511544 L -30.094523195734084 47.42138052245479 L -33.506919951795965 46.11831883232669 L -36.73461933738236 44.404526850236586 L -39.67885228318335 42.25368602981457 L -42.25368602981467 39.67885228318322 L -44.40452685023667 36.73461933738222 L -46.118318832326764 33.50691995179581 L -47.42138052245485 30.09452319573392 L -48.36757380251158 26.590298713207773 L -49.02340517788068 23.068663420106272 L -49.455699619313215 19.580896673972788 L -49.72412933283186 16.156348998269358 L -49.87814575846598 12.80653116683458 L -49.95677212981057 9.529763953669406 L -49.98976784243647 6.315176300200125 L -49.999107689126554 3.145677223240676 L -49.999999999999986 -1.27103528959282e-13 L -49.999107689126554 -3.14567722324093 L -49.989767842436464 -6.315176300200383 L -49.95677212981057 -9.529763953669669 L -49.878145758465976 -12.806531166834848 L -49.72412933283184 -16.156348998269632 L -49.45569961931319 -19.580896673973065 L -49.02340517788064 -23.068663420106557 L -48.36757380251151 -26.590298713208057 L -47.421380522454754 -30.094523195734205 L -46.118318832326636 -33.50691995179608 L -44.40452685023652 -36.73461933738247 L -42.25368602981448 -39.67885228318344 L -39.67885228318312 -42.25368602981475 L -36.73461933738212 -44.40452685023674 L -33.506919951795716 -46.1183188323268 L -30.094523195733853 -47.42138052245486 L -26.590298713207723 -48.36757380251158 L -23.068663420106255 -49.02340517788069 L -19.580896673972788 -49.45569961931321 L -16.156348998269383 -49.72412933283185 L -12.806531166834628 -49.87814575846598 L -9.529763953669478 -49.956772129810574 L -6.315176300200218 -49.989767842436464 L -3.1456772232407895 -49.999107689126554 L -9.184850993605146e-15 -49.999999999999986 L 3.145677223240771 -49.999107689126554 L 6.315176300200198 -49.989767842436464 L 9.529763953669457 -49.95677212981057 L 12.806531166834608 -49.878145758465976 L 16.156348998269365 -49.72412933283186 L 19.58089667397277 -49.45569961931321 L 23.068663420106233 -49.02340517788068 L 26.5902987132077 -48.36757380251158 L 30.09452319573383 -47.421380522454875 L 33.506919951795695 -46.11831883232681 L 36.73461933738209 -44.404526850236756 L 39.67885228318309 -42.25368602981479 L 42.25368602981444 -39.678852283183495 L 44.404526850236465 -36.734619337382554 L 46.118318832326594 -33.50691995179619 L 47.42138052245471 -30.094523195734347 L 48.36757380251147 -26.590298713208227 L 49.02340517788061 -23.068663420106756 L 49.45569961931316 -19.58089667397328 L 49.724129332831815 -16.156348998269863 L 49.87814575846597 -12.8065311668351 L 49.95677212981056 -9.529763953669939 L 49.989767842436464 -6.3151763002006716 L 49.999107689126554 -3.1456772232412384 L 49.999999999999986 -4.56335677841536e-13' fill='black'/%3E%3C/svg%3E")
    0 0 / 100% 100% no-repeat;
  -webkit-mask: var(--mask);
  mask: var(--mask); */
}
#superellipse > svg {
  /* background: linear-gradient(to bottom right, orange, orangered); */
  /* mix-blend-mode: exclusion; */
}
.stop1 { stop-color: red; }
.stop2 { stop-color: black; stop-opacity: 0; }
.stop3 { stop-color: rgb(255, 123, 0); }
#superellipse::before {
  content: '';
  position: absolute;
  width: 100px;
  height: 100px;
  /* background: url('../assets/avatar.png'); */
  background-repeat: no-repeat;
  background-size: 100px 100px;
}
#superellipse:hover {
  /* animation: scaleMask 1s; */
  transition-duration: 0.5s;
  /* --mask: url("data:image/svg+xml,%3Csvg width='200' height='200' viewBox='-50 -50 100 100' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 50 0 L 50 0 L 49.999999999139156 3.145733362628328 L 49.999999738487844 6.316468889268741 L 49.99999232363542 9.538008646583476 L 49.999912254152264 12.837795489081838 L 49.99939508340603 16.245788262329356 L 49.99694165131364 19.79518955398046 L 49.987407025671416 23.522288256699316 L 49.95504857908347 27.463020356866963 L 49.85546544175404 31.639240457382492 L 49.57314504126768 36.01699811945903 L 48.845128676899364 40.4082046518145 L 47.22491931377936 44.347151067826516 L 44.34715106782654 47.224919313779345 L 40.40820465181453 48.84512867689936 L 36.01699811945906 49.57314504126768 L 31.639240457382517 49.85546544175404 L 27.46302035686697 49.95504857908347 L 23.52228825669932 49.987407025671416 L 19.795189553980457 49.99694165131364 L 16.24578826232935 49.99939508340603 L 12.837795489081824 49.999912254152264 L 9.53800864658346 49.99999232363542 L 6.316468889268719 49.999999738487844 L 3.1457333626283024 49.999999999139156 L -3.024507374088631e-14 50 L -3.145733362628363 49.999999999139156 L -6.316468889268779 49.999999738487844 L -9.538008646583522 49.99999232363542 L -12.83779548908189 49.99991225415227 L -16.24578826232941 49.999395083406014 L -19.795189553980528 49.996941651313634 L -23.522288256699383 49.98740702567142 L -27.463020356867037 49.95504857908347 L -31.639240457382577 49.855465441754035 L -36.016998119459124 49.57314504126767 L -40.4082046518146 48.845128676899336 L -44.34715106782661 47.224919313779296 L -47.2249193137794 44.34715106782645 L -48.845128676899385 40.4082046518144 L -49.57314504126769 36.016998119458925 L -49.85546544175404 31.639240457382375 L -49.95504857908347 27.463020356866846 L -49.98740702567143 23.522288256699206 L -49.996941651313634 19.795189553980347 L -49.99939508340603 16.24578826232924 L -49.999912254152264 12.83779548908172 L -49.99999232363541 9.538008646583359 L -49.99999973848784 6.31646888926862 L -49.99999999913916 3.1457333626282056 L -50 -1.2710352895928203e-13 L -49.99999999913916 -3.1457333626284605 L -49.99999973848784 -6.3164688892688785 L -49.99999232363541 -9.53800864658362 L -49.99991225415227 -12.837795489081994 L -49.99939508340603 -16.24578826232952 L -49.99694165131364 -19.79518955398064 L -49.98740702567142 -23.522288256699515 L -49.95504857908347 -27.463020356867172 L -49.85546544175403 -31.639240457382726 L -49.57314504126765 -36.01699811945928 L -48.8451286768993 -40.40820465181474 L -47.224919313779225 -44.34715106782672 L -44.347151067826324 -47.22491931377948 L -40.40820465181426 -48.84512867689943 L -36.0169981194588 -49.5731450412677 L -31.63924045738229 -49.85546544175404 L -27.463020356866792 -49.95504857908347 L -23.52228825669918 -49.98740702567142 L -19.795189553980347 -49.996941651313634 L -16.245788262329267 -49.99939508340602 L -12.837795489081772 -49.99991225415227 L -9.538008646583434 -49.999992323635425 L -6.316468889268714 -49.999999738487844 L -3.1457333626283197 -49.999999999139156 L -9.184850993605149e-15 -50 L 3.145733362628301 -49.999999999139156 L 6.316468889268693 -49.99999973848784 L 9.538008646583412 -49.99999232363541 L 12.83779548908175 -49.999912254152264 L 16.24578826232925 -49.99939508340603 L 19.79518955398033 -49.996941651313634 L 23.52228825669916 -49.98740702567142 L 27.463020356866764 -49.95504857908346 L 31.639240457382268 -49.85546544175405 L 36.01699811945877 -49.57314504126771 L 40.40820465181422 -48.845128676899435 L 44.347151067826275 -47.2249193137795 L 47.224919313779175 -44.34715106782679 L 48.84512867689927 -40.40820465181486 L 49.57314504126764 -36.01699811945943 L 49.85546544175402 -31.639240457382904 L 49.95504857908346 -27.463020356867368 L 49.98740702567142 -23.522288256699728 L 49.996941651313634 -19.795189553980865 L 49.99939508340602 -16.245788262329757 L 49.99991225415227 -12.837795489082248 L 49.99999232363541 -9.538008646583894 L 49.999999738487844 -6.316468889269167 L 49.99999999913916 -3.145733362628769 L 50 -4.563356778415361e-13' fill='black'/%3E%3C/svg%3E")
    0 0 / 100% 100% no-repeat; */
}
path {
  transition: 0.5s ease-in-out;
}
svg > * {
  /* mix-blend-mode: multiply; */
}
</style>
