<template lang="pug">
nav
  v-app-bar(promiment, app, :height='windowHeight * 0.3')
    // Title
    v-toolbar-title.text-uppercase.grey--text
      #superellipse
        svg(
          :style='"width:" + svg_rect_size[mode] + ";height:" + svg_rect_size[mode]',
          width='200',
          height='200',
          viewBox='-50 -50 100 100',
          fill='linear-gradient(to bottom right, orange, orangered)',
          xmlns='http://www.w3.org/2000/svg'
        )
          mask#img-mask
            rect(x='-50', y='-50', height='100px', width='100px', fill='black')
            path(:d='d[mode]', fill='white')
          path(:d='d[mode]', fill='url(#Gradient1)')
          image(
            :href='require("../assets/avatar.png")',
            x='-50px',
            y='-50px',
            height='100px',
            width='100px',
            mask='url(#img-mask)'
          )
          defs
            linearGradient#Gradient1(x1='0', x2='1', y1='0', y2='1')
              stop.stop1(offset='0%')
              stop.stop3(offset='100%')
      span {{ $t("title") }}
    v-spacer
    // Dark mode
    v-btn(text, icon, color='grey', @click='toggleMode')
      v-icon(small) brightness_2
    v-btn(@click='toggleNavMode')
      a toggle
    // Language picker
    v-menu(offset-y)
      template(v-slot:activator='{ on }')
        v-btn(text, icon, color='grey', v-on='on') {{ currentLocale.icon }}
      v-list
        v-list-item(
          v-for='locale in locales',
          @click='changeLanguage(locale.code)',
          :key='locale.code'
        )
          v-list-item-title {{ locale.icon }}
</template>

<script lang="ts">
import Vue from 'vue'
import Component from 'vue-class-component'
import { Watch } from 'vue-property-decorator'
import { i18n } from '@/plugins/i18n'
import * as api from '@/utils/api'
import { namespace } from 'vuex-class'

const AppStore = namespace('AppStore')

@Component
export default class Navbar extends Vue {
  @AppStore.State dark!: boolean

  @AppStore.Mutation setDark!: (dark: boolean) => void
  @AppStore.Mutation setLanguage!: (language: string) => void

  mode = 1 // 1 means expanded, 0 small
  toggleNavMode() {
    // inverts value
    if (this.mode) this.mode = 0
    else this.mode = 1
  }

  get locales() {
    return [
      { icon: 'ðŸ‡ºðŸ‡¸', code: 'en' },
      { icon: 'ðŸ‡·ðŸ‡º', code: 'ru' },
    ]
  }
  get currentLocale() {
    for (const locale of this.locales) {
      if (locale.code === i18n.locale) {
        return locale
      }
    }
  }

  get windowHeight() {
    return window.innerHeight
  }

  toggleMode() {
    this.setDark(!this.dark)
    ;(this.$vuetify.theme as any).dark = this.dark
  }
  changeLanguage(locale: string) {
    i18n.locale = locale
    this.setLanguage(locale)
    document.title = i18n.t('strippedTitle') as string
  }

  d = [
    'M 50 0 L 49.999999999999986 0 L 49.99585015030197 3.1454722762695835 L 49.96644334769512 6.312229731277001 L 49.884838203919955 9.516041823420254 L 49.721035988420205 12.766192234099531 L 49.441023607284336 16.064362371922776 L 49.00641513579085 19.403012363028175 L 48.37501334430108 22.763553382994107 L 47.502692707586824 26.11482630767943 L 46.3469325088863 29.412657752115457 L 44.8719878482977 32.601407487928036 L 43.05503439807748 35.618222090409425 L 40.891833121543975 38.3999872785878 L 38.399987278587815 40.89183312154396 L 35.61822209040944 43.05503439807747 L 32.60140748792806 44.87198784829769 L 29.41265775211548 46.3469325088863 L 26.114826307679436 47.502692707586824 L 22.76355338299411 48.37501334430108 L 19.403012363028175 49.00641513579085 L 16.064362371922766 49.44102360728432 L 12.766192234099517 49.721035988420205 L 9.516041823420238 49.884838203919955 L 6.312229731276979 49.96644334769512 L 3.1454722762695577 49.99585015030197 L -3.0245073740886305e-14 49.999999999999986 L -3.145472276269618 49.99585015030197 L -6.31222973127704 49.96644334769512 L -9.516041823420302 49.88483820391997 L -12.766192234099579 49.7210359884202 L -16.064362371922826 49.441023607284315 L -19.40301236302824 49.00641513579084 L -22.763553382994168 48.375013344301074 L -26.11482630767949 47.50269270758681 L -29.412657752115525 46.346932508886276 L -32.60140748792811 44.871987848297664 L -35.61822209040949 43.05503439807743 L -38.399987278587865 40.89183312154391 L -40.891833121544025 38.399987278587744 L -43.055034398077524 35.618222090409354 L -44.87198784829774 32.60140748792796 L -46.34693250888633 29.41265775211537 L -47.50269270758686 26.114826307679337 L -48.37501334430111 22.76355338299401 L -49.00641513579087 19.403012363028072 L -49.44102360728434 16.064362371922662 L -49.72103598842021 12.766192234099416 L -49.88483820391996 9.516041823420137 L -49.96644334769512 6.312229731276881 L -49.995850150301976 3.1454722762694614 L -49.999999999999986 -1.27103528959282e-13 L -49.99585015030197 -3.1454722762697154 L -49.96644334769511 -6.312229731277139 L -49.88483820391995 -9.516041823420398 L -49.7210359884202 -12.766192234099682 L -49.441023607284315 -16.064362371922932 L -49.006415135790824 -19.403012363028346 L -48.375013344301045 -22.76355338299428 L -47.50269270758678 -26.114826307679607 L -46.346932508886226 -29.412657752115635 L -44.87198784829761 -32.601407487928206 L -43.05503439807737 -35.61822209040959 L -40.89183312154384 -38.39998727858796 L -38.39998727858765 -40.8918331215441 L -35.618222090409255 -43.05503439807759 L -32.60140748792787 -44.871987848297785 L -29.412657752115305 -46.346932508886354 L -26.114826307679287 -47.50269270758687 L -22.76355338299399 -48.37501334430111 L -19.403012363028076 -49.00641513579087 L -16.064362371922687 -49.44102360728433 L -12.766192234099465 -49.721035988420205 L -9.516041823420212 -49.88483820391996 L -6.312229731276974 -49.96644334769512 L -3.145472276269575 -49.99585015030197 L -9.184850993605146e-15 -49.999999999999986 L 3.1454722762695564 -49.99585015030197 L 6.312229731276954 -49.96644334769512 L 9.516041823420192 -49.88483820391997 L 12.766192234099444 -49.721035988420205 L 16.06436237192267 -49.44102360728434 L 19.403012363028054 -49.00641513579087 L 22.76355338299397 -48.37501334430112 L 26.114826307679266 -47.50269270758687 L 29.412657752115287 -46.34693250888637 L 32.60140748792785 -44.8719878482978 L 35.61822209040923 -43.0550343980776 L 38.39998727858762 -40.89183312154413 L 40.89183312154379 -38.39998727858801 L 43.05503439807731 -35.618222090409674 L 44.87198784829755 -32.60140748792831 L 46.34693250888618 -29.412657752115773 L 47.502692707586725 -26.114826307679763 L 48.375013344301 -22.763553382994466 L 49.00641513579079 -19.40301236302855 L 49.441023607284286 -16.06436237192316 L 49.72103598842018 -12.76619223409993 L 49.88483820391995 -9.51604182342067 L 49.96644334769511 -6.3122297312774265 L 49.99585015030197 -3.145472276270024 L 49.999999999999986 -4.56335677841536e-13',
    'M 50 0 L 50 0 L 49.999999998465746 3.1457333625859607 L 49.99999959457094 6.316468871087808 L 49.99998904072608 9.538008020335027 L 49.99988195568147 12.837787709756752 L 49.999223649243866 16.245732559993463 L 49.996227212484264 19.79490668763734 L 49.98499468942409 23.521153097427053 L 49.94809606361476 27.4591981791436 L 49.83795702131169 31.62812927590026 L 49.53484019259086 35.98916801786652 L 48.775626963203315 40.35070783387675 L 47.129737118089 44.25776903663231 L 44.25776903663233 47.12973711808898 L 40.35070783387677 48.7756269632033 L 35.98916801786654 49.534840192590856 L 31.628129275900285 49.837957021311695 L 27.459198179143606 49.94809606361476 L 23.521153097427057 49.98499468942409 L 19.794906687637337 49.996227212484264 L 16.245732559993456 49.999223649243866 L 12.837787709756736 49.99988195568147 L 9.53800802033501 49.99998904072608 L 6.316468871087785 49.99999959457094 L 3.145733362585935 49.999999998465746 L -3.024507374088631e-14 50 L -3.145733362585996 49.999999998465746 L -6.316468871087846 49.99999959457094 L -9.538008020335074 49.99998904072608 L -12.837787709756801 49.99988195568147 L -16.24573255999352 49.999223649243866 L -19.794906687637408 49.996227212484264 L -23.52115309742712 49.9849946894241 L -27.45919817914367 49.948096063614756 L -31.62812927590035 49.83795702131169 L -35.989168017866604 49.53484019259084 L -40.35070783387685 48.77562696320329 L -44.2577690366324 47.12973711808893 L -47.12973711808905 44.25776903663225 L -48.77562696320334 40.35070783387665 L -49.53484019259087 35.989168017866405 L -49.837957021311695 31.628129275900143 L -49.94809606361476 27.45919817914348 L -49.984994689424106 23.521153097426943 L -49.99622721248427 19.794906687637226 L -49.999223649243866 16.245732559993346 L -49.999881955681474 12.837787709756636 L -49.99998904072607 9.538008020334908 L -49.999999594570944 6.316468871087688 L -49.99999999846575 3.1457333625858386 L -50 -1.2710352895928203e-13 L -49.99999999846575 -3.1457333625860926 L -49.999999594570944 -6.316468871087946 L -49.99998904072608 -9.538008020335171 L -49.999881955681474 -12.837787709756906 L -49.999223649243866 -16.245732559993627 L -49.996227212484264 -19.79490668763752 L -49.9849946894241 -23.52115309742725 L -49.948096063614756 -27.459198179143808 L -49.83795702131168 -31.628129275900495 L -49.53484019259083 -35.98916801786675 L -48.775626963203244 -40.35070783387699 L -47.12973711808886 -44.257769036632524 L -44.25776903663212 -47.12973711808912 L -40.350707833876506 -48.77562696320338 L -35.98916801786628 -49.53484019259088 L -31.62812927590006 -49.837957021311695 L -27.459198179143424 -49.948096063614756 L -23.521153097426918 -49.9849946894241 L -19.79490668763723 -49.99622721248427 L -16.245732559993375 -49.999223649243866 L -12.837787709756684 -49.99988195568147 L -9.538008020334983 -49.99998904072608 L -6.316468871087781 -49.99999959457094 L -3.1457333625859527 -49.999999998465746 L -9.184850993605149e-15 -50 L 3.1457333625859336 -49.999999998465746 L 6.316468871087761 -49.99999959457094 L 9.538008020334964 -49.99998904072608 L 12.837787709756665 -49.99988195568147 L 16.245732559993357 -49.999223649243866 L 19.79490668763721 -49.99622721248427 L 23.521153097426897 -49.9849946894241 L 27.4591981791434 -49.948096063614756 L 31.628129275900033 -49.837957021311695 L 35.989168017866255 -49.53484019259089 L 40.35070783387647 -48.77562696320338 L 44.257769036632084 -47.12973711808915 L 47.12973711808881 -44.25776903663259 L 48.775626963203216 -40.3507078338771 L 49.53484019259081 -35.98916801786691 L 49.837957021311674 -31.628129275900672 L 49.948096063614756 -27.459198179144003 L 49.98499468942409 -23.52115309742746 L 49.99622721248427 -19.79490668763775 L 49.999223649243866 -16.24573255999387 L 49.999881955681474 -12.837787709757162 L 49.99998904072607 -9.538008020335445 L 49.99999959457094 -6.316468871088234 L 49.99999999846575 -3.1457333625864017 L 50 -4.563356778415361e-13',
  ]
  svg_rect_size = ['75px', '150px']

  maskPath(eccentricity: number) {
    const halfWidth = 100 / 2.0
    const halfHeight = 100 / 2.0

    const TWO_PI = Math.PI * 2.0
    const resolution = 100

    var d = 'M ' + halfWidth + ' ' + 0

    // wierd math https://observablehq.com/@tomwhite/superellipse-generator

    for (var theta = 0.0; theta < TWO_PI; theta += TWO_PI / resolution) {
      var sineTheta = Math.sin(theta)
      var cosineTheta = Math.cos(theta)
      var r = Math.pow(
        1 /
          (Math.pow(Math.abs(cosineTheta) / halfWidth, eccentricity) +
            Math.pow(Math.abs(sineTheta) / halfHeight, eccentricity)),
        1 / eccentricity
      )
      d += ' L ' + r * cosineTheta + ' ' + r * sineTheta
    }
    return d
  }

  mounted() {
    // not required, but that's easier to change values
    this.d[0] = this.maskPath(3)
    this.d[1] = this.maskPath(8)
  }

  pageYOffset() {
    return window.pageYOffset
  }

  @Watch('pageYOffset')
  onScroll(value: number) {
    console.log(value)
  }
}
</script>

<style>
nav a:link {
  text-decoration: none;
}

nav a:visited {
  text-decoration: none;
}

nav a:hover {
  text-decoration: underline;
}

nav a:active {
  text-decoration: underline;
}

.stop1 {
  stop-color: red;
}
.stop2 {
  stop-color: black;
  stop-opacity: 0;
}
.stop3 {
  stop-color: rgb(255, 123, 0);
}

svg, path {
  transition: 0.5s ease-in-out;
}
</style>
